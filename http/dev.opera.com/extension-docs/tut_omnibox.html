<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Creating address bar extensions - Opera 15+ extensions documentation</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
		<link href="http://netdna.bootstrapcdn.com/bootswatch/2.3.2/cosmo/bootstrap.min.css" rel="stylesheet">
		<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.1.1/css/bootstrap-responsive.min.css" rel="stylesheet">
		<link href="css/custom.css" rel="stylesheet" media="screen">
	</head>
	<body>
		<div id="wrap">
			<nav id="navbar" class="navbar navbar-fixed-top">
				<div class="navbar-inner">
					<div class="container-fluid">
						<button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						</button>
						<a class="brand" href="index.html">Opera 15+ extensions documentation</a>
						<div class="nav-collapse collapse">
							<ul class="nav">
								<li><a href="contact.html">Contact</a></li>
								<li><a href="../index.html">&uarr; Dev.Opera</a></li>
							</ul>
							<form class="navbar-search pull-right" action="http://dev.opera.com/extension-docs/search.html">
							  <input name="q" type="text" class="search-query span3" placeholder="Search extension docs">
							</form>
						</div><!-- /.nav-collapse -->
					</div><!-- /.container-fluid -->
				</div><!-- /.navbar-inner -->
			</nav>
			<div class="container-fluid">
				<div class="row-fluid">
					<div class="span8">

						<h1>Creating address bar extensions</h1>
					
					
					 
						<p class="badge pull-right">by <a href="https://github.com/shwetank/">Shwetank Dixit</a></p>
					
    <h2 id="introduction">Introduction</h2>

<p>Address bar (or “omnibox”) extensions are extensions which kick in when you enter a keyword as the first word in the address bar. When you enter that word, then whatever text you enter next will interact solely with that extension. You can then take that text and give the user suggestions in the address bar, or you can process that text and send the user to a specified page. There are quite a few interesting use cases that open up with this functionality.</p>

<p><img alt='Address bar extension' class='img-polaroid' src='static/images/omnibox1.png' /></p>

<h2 id="manifest_specifications">Manifest specifications</h2>

<p>One of the most important things to understand for address bar extensions is the manifest. An example of an address bar extension’s manifest file is something like this:</p>
<pre class='prettyprint'>{
  "manifest_version": 2,

   "name": "Opera Extensions Docs Search",
   "version": "1.0",
   "omnibox": { "keyword" : "extquery" },
   "icons": {
     "16": "icon_16.png"
   },
   "background": {
     "persistent": false,
     "scripts": ["background.js"]
   }
 }
 </pre>
<p>As you can note from the example, you need to use the <code>omnibox</code> field. Inside this field, you need to define your keyword inside the <code>keyword</code> subfield. In our case, we are using the keyword <em>extdocs</em> — so whenever the user enters <em>extdocs</em>, the extension kicks in, ready to process whatever text comes next.</p>

<p>In the <code>icons</code> field, we specify what icon comes up in the address bar when your keyword is entered. This needs to be a 16x16 icon.</p>

<h2 id="using_the_chromeomnibox_api">Using the chrome.omnibox API</h2>

<p>We have used the manifest to define the keyword we’ll use. Great! Now let’s go on and actually process the text to do something useful. One of the most common use cases for the <a href="omnibox.html">chrome.omnibox API</a> would be to take the text and search a certain website with it.</p>

<p>So let’s make an extension which takes the text and searches this site for content. In the API, we have access to event handlers dealing with various stages of the user entering content (for example, when the user has started entering text, when the user has finished typing, when the text has changed, when the text entered is accepted, etc.)</p>

<p>For our example, we will use the <a href="omnibox.html#event-onInputEntered"><code>onInputEntered</code></a> event handler to take the user’s input and take the user to the search page. The background page for our extensions would like so:</p>
<pre class='prettyprint'>chrome.omnibox.onInputEntered.addListener(
  function(text) {
 	var qString = &quot;http://dev.opera.com/extension-docs/search.html?q=&quot;+encodeURIComponent(text);  
   	chrome.tabs.query({'currentWindow': true, 'active': true}, function(tab) { 
    	chrome.tabs.update(tab[0].id, {&quot;url&quot;: qString });
   	});
});
  </pre>
<p>The above code will listen to the user’s input and when he hits enter, then it will take the input and redirect to the Opera extensions documentation page with what the user entered as the search query.</p>

<p>Feel free to <a href="samples/Omnibox.nex">download this extension</a> and try it out yourself.</p>

<h2 id="suggestions_in_the_address_bar">Suggestions in the address bar</h2>

<p>The API also enables developers to provide suggestions to the user in the address bar as they type via the <a href="omnibox.html#event-onInputChanged"><code>onInputChanged</code></a> event handler. This event throws back the text which has been typed until now, as well as a function in which we can put our search suggestion as part of an array of <a href="omnibox.html#type-SuggestResult"><code>suggestionResult</code></a> objects. Let’s see how it’s done.</p>
<pre class='prettyprint'>chrome.omnibox.onInputChanged.addListener(
  function(text, suggest) {
  	
  	var suggestionsList = [
  		{&quot;content&quot;: &quot;http://dev.opera.com/extension-docs/search.html?q=&quot;+encodeURIComponent(text), &quot;description&quot;: &quot;Search Opera Extensions Documentation&quot;},
  		{&quot;content&quot;: &quot;http://stackoverflow.com/search?q=&quot;+encodeURIComponent(&quot;[opera-extension] &quot;+text), &quot;description&quot;: &quot;Do a Stack Overflow Search&quot;},
  		{&quot;content&quot;: &quot;https://www.google.com/search?q=&quot;+encodeURIComponent(text), &quot;description&quot;: &quot;Search on Google&quot;}
  	];
  	
  	chrome.omnibox.setDefaultSuggestion({&quot;description&quot;:suggestionsList[0].description});
	suggestionsList.shift(); /*First suggestion is already shown by default because we used setDefaultSuggestion, so we delete it from the array*/
  	suggest(suggestionsList);
});
  </pre>
<p>One thing to keep in mind is that when the user selects the default suggestion, it will by default not have a URL attached to it. So we will process the entered text at the point when the user has finally hit <em>enter</em> in the address bar, and see if it’s a proper URL or not. If not, we will convert it to a proper URL, and point the user to the appropriate page, like so:</p>
<pre class='prettyprint'>
chrome.omnibox.onInputEntered.addListener(
  function(text) {
 	  
 	if (text.substr(0, 4) != &#39;http&#39;){ /*User selects the suggested suggestion, which will result in the text not being converted to a URL (thus not having an &#39;http&#39; at the beginning of the string), so we will have to append a URL to it again.*/
 	var qString = &quot;http://dev.opera.com/extension-docs/search.html?q=&quot;+encodeURIComponent(text);
 		
 	}  else {
 		var qString = text;
 	}
 	
 	chrome.tabs.query({&#39;currentWindow&#39;: true, &#39;active&#39;: true}, function(tab) { 
 		chrome.tabs.update(tab[0].id, {&quot;url&quot;: qString });
 	});
});
  
</pre>
<p>You can <a href="samples/Omnibox2.nex">download the extension</a> — the keyword for this extension is <em>extdocs</em>, so type that followed by your search query — and see that the default suggestion is to search on the Opera Extensions documentation site . The next option is a search on StackOverflow with the tag <code>[opera-extension]</code>, followed by a Google search. Keep in mind that all other options apart from the default one are listed in alphabetical order of their descriptions.</p>

<p>You can go further and have suggestions in the address bar by doing an Ajax request to your web service, with the suggestions executed in a similar manner as the one shown above.</p>

<p>Making an address bar extension is pretty easy, so <a href="omnibox.html">check out the API</a> and get cracking!</p>
  					</div><!-- .span8 -->
				<nav id="sidebar" class="span4 well well-small">
					<ul class="nav nav-list">
						<li>
							<h2 class="nav-header">Tutorials</h2>
							<ul class="nav nav-list">
								<li><a href="tut_getting_started.html">Getting started</a></li>
								<li><a href="tut_architecture_overview.html">Architecture overview</a></li>
								<li><a href="tut_basics.html">The basics of making an extension</a></li>
								<li><a href="tut_browser_actions.html">Buttons, popups and badges (browser actions)</a></li>
								<li><a href="tut_message_passing.html">Passing messages in extensions</a></li>
								<li><a href="tut_tab_window.html">Working with tabs and windows</a></li>
								<li><a href="tut_content_scripts.html">Content scripts</a></li>
								<li><a href="tut_match_patterns.html">Match patterns</a></li>
								<li><a href="declare_permissions.html">Permissons declarations</a></li>
								<li><a href="tut_optional_permissions.html">Optional permissions</a>
								<li><a href="tut_context_menus.html">Working with the context menu</a></li>
								<li><a href="tut_sd_extensions.html">Speed Dial extensions</a></li>
								<li><a href="tut_bookmarks.html">Working with bookmarks</a></li>
								<li><a href="tut_downloads.html">Working with downloads</a></li>
								<li><a href="tut_hist.html">Working with the browser history</a></li>
								<li><a href="tut_removing_browsingdata.html">Removing browsing data</a></li>
								<li><a href="tut_privacy.html">Controlling privacy features</a></li>
								<li><a href="tut_omnibox.html">Creating address bar extensions</a></li>
								<li><a href="tut_contentsettings.html">Site-specific customization</a></li>
								<li><a href="tut_commands.html">Adding keyboard shortcuts</a></li>
								<li><a href="tut_webnavigation.html">Using webNavigation</a></li>
								<li><a href="tut_proxy.html">Using the Proxy API</a></li>
								<li><a href="tut_offroad.html">Working with Off-Road Mode</a></li>
								<li><a href="tut_internationalization.html">Internationalization</a></li>
								<li><a href="devtools.html">Extending DevTools</a></li>
								<li><a href="tut_testing.html">Testing and debugging your extensions</a></li>
								<li><a href="tut_conversion.html">Converting OEX extensions to CRX/NEX</a></li>
								<li><a href="tut_icons.html">Creating effective icons</a></li>
								<li><a href="tut_extension_samples.html">Extension templates and samples</a></li>
								<li><a href="tut_publishing_guidelines.html">Publishing guidelines</a></li>
							</ul>
						</li>
						<li>
							<h2 class="nav-header">API Docs</h2>
							<ul class="nav nav-list">
								<li><a href="manifest.html">Formats: Manifest Files</a></li>
								<li><a href="alarms.html">chrome.alarms</a></li>
								<li><a href="bookmarks.html">chrome.bookmarks</a></li>
								<li><a href="browserAction.html">chrome.browserAction</a></li>
								<li><a href="browsingData.html">chrome.browsingData</a></li>
								<li><a href="commands.html">chrome.commands</a></li>
								<li><a href="contentSettings.html">chrome.contentSettings</a></li>
								<li><a href="contextMenus.html">chrome.contextMenus</a></li>
								<li><a href="cookies.html">chrome.cookies</a></li>
								<li><a href="devtools.inspectedWindow.html">chrome.devtools.inspectedWindow</a></li>
								<li><a href="devtools.network.html">chrome.devtools.network</a></li>
								<li><a href="devtools.panels.html">chrome.devtools.panels</a></li>
								<li><a href="downloads.html">chrome.downloads</a></li>								
								<li><a href="events.html">chrome.events</a></li>
								<li><a href="extension.html">chrome.extension</a></li>
								<li><a href="fontSettings.html">chrome.fontSettings</a></li>
								<li><a href="history.html">chrome.history</a></li>
								<li><a href="i18n.html">chrome.i18n</a></li>
								<li><a href="identity.html">chrome.identity</a></li>
								<li><a href="idle.html">chrome.idle</a></li>
								<li><a href="management.html">chrome.management</a></li>
								<li><a href="omnibox.html">chrome.omnibox</a></li>
								<li><a href="pageAction.html">chrome.pageAction</a></li>
								<li><a href="pageCapture.html">chrome.pageCapture</a></li>
								<li><a href="permissions.html">chrome.permissions</a></li>
								<li><a href="power.html">chrome.power</a></li>
								<li><a href="privacy.html">chrome.privacy</a></li>
								<li><a href="proxy.html">chrome.proxy</a></li>
								<li><a href="runtime.html">chrome.runtime</a></li>
								<li><a href="storage.html">chrome.storage</a></li>
								<li><a href="tabs.html">chrome.tabs</a></li>
								<li><a href="types.html">chrome.types</a></li>
								<li><a href="webNavigation.html">chrome.webNavigation</a></li>
								<li><a href="webRequest.html">chrome.webRequest</a></li>
								<li><a href="windows.html">chrome.windows</a></li>
								<li><a href="speeddial.html">opr.speeddial</a></li>
								<li><a href="stash.html">opr.stash</a></li>
							</ul>
						</li>
					</ul>
				</nav>
			</div><!-- .row-fluid -->
				<div id="push"></div><!-- this is for sticky footer: http://twitter.github.com/bootstrap/examples/sticky-footer-navbar.html -->
			</div><!-- /.container-fluid -->
		</div><!-- /#wrap -->
		<footer id="footer">
			
			<p>© 2013-2014 Opera Software. This article is licensed under a <a href="http://creativecommons.org/licenses/by/3.0/" rel="license">Creative Commons Attribution 3.0 Unported</a> license.</p>
			
		</footer>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
		<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
		<script src="js/prettify/run_prettify.js"></script>
		<script>
		 $(function(){
						var path = location.pathname.slice(location.pathname.lastIndexOf('/')+1);
						if ( path )
								$('#sidebar a[href="' + path + '"]').parent().attr('class', 'active');
								$('#navbar ul a[href$="' + path + '"]').parent().attr('class', 'active');
				});
			// see http://docs.jquery.com/Tutorials:Auto-Selecting_Navigation and Ola's fix
		</script>

		<script>
		  (function() {
		    var cx = '017162326639705525688:re0yffa7zqy';
		    var gcse = document.createElement('script');
		    gcse.type = 'text/javascript';
		    gcse.async = true;
		    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
		        '//www.google.com/cse/cse.js?cx=' + cx;
		    var s = document.getElementsByTagName('script')[0];
		    s.parentNode.insertBefore(gcse, s);
		  })();
		</script>

		<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-4118503-4']);
_gaq.push(['_gat._anonymizeIp']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
    </script>

	</body>
</html>	